<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구형 로봇 자석 설계 계산기 (검증모드)</title>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        h1 { font-size: 26px; margin-bottom: 10px; color: #111; letter-spacing: -0.5px; }
        .subtitle { color: #666; margin-bottom: 30px; font-size: 15px; }
        
        /* 입력 폼 스타일 */
        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
            border-left: 4px solid #0071e3;
            padding-left: 10px;
        }
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .input-group { display: flex; flex-direction: column; }
        label { font-size: 13px; font-weight: 600; margin-bottom: 8px; color: #555; }
        input, select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            background-color: #fafafa;
            transition: all 0.2s;
        }
        input:focus, select:focus { outline: none; border-color: #0071e3; background-color: #fff; box-shadow: 0 0 0 3px rgba(0,113,227,0.1); }
        
        button {
            width: 100%;
            padding: 16px;
            background-color: #0071e3;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
        }
        button:hover { background-color: #005bb5; }
        button:active { transform: scale(0.98); }

        /* 결과 박스 스타일 */
        .result-box {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid #eee;
            animation: fadeIn 0.5s ease-out;
        }
        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .result-row:last-child { border-bottom: none; }
        .result-label { color: #555; font-weight: 500; }
        .result-value { font-weight: 700; color: #0071e3; font-size: 1.1em; }
        
        /* 안전 배지 */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            font-size: 13px;
            font-weight: 800;
        }
        .safe { background-color: #34c759; }
        .warning { background-color: #ff9f0a; }
        .danger { background-color: #ff3b30; }

        /* 검증(수식) 섹션 스타일 */
        .verification-box {
            margin-top: 30px;
            padding: 20px;
            background-color: #282c34;
            color: #abb2bf;
            border-radius: 12px;
            font-family: 'D2Coding', 'Consolas', monospace;
            font-size: 14px;
            overflow-x: auto;
            line-height: 1.8;
            border: 1px solid #3e4451;
        }
        .ver-title {
            color: #61afef;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 1px solid #3e4451;
            padding-bottom: 10px;
        }
        .math-var { color: #e06c75; } /* 변수 빨강 */
        .math-num { color: #d19a66; } /* 숫자 주황 */
        .math-res { color: #98c379; font-weight: bold; } /* 결과 녹색 */
        .math-comment { color: #5c6370; font-style: italic; } /* 주석 회색 */
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <h1> 구형 로봇 자석 설계 계산기</h1>
    <p class="subtitle">N52 자석 스펙과 공극(Gap)을 입력하여 인력을 계산하고, 하단에서 수식 검증 과정을 확인하세요.</p>

    <div class="section-title">1. 자석 스펙 및 배치</div>
    <div class="input-grid">
        <div class="input-group">
            <label>자석 등급 (Grade)</label>
            <select id="grade">
                <option value="1.19">N35 (Br ≈ 1.19T)</option>
                <option value="1.30">N42 (Br ≈ 1.30T)</option>
                <option value="1.42">N50 (Br ≈ 1.42T)</option>
                <option value="1.48" selected>N52 (Br ≈ 1.48T)</option>
            </select>
        </div>
        <div class="input-group">
            <label>자석 개수 (Array Size)</label>
            <input type="number" id="count" value="9" placeholder="예: 9 (3x3)">
        </div>
        <div class="input-group">
            <label>결합 방식 (Coupling)</label>
            <select id="coupling">
                <option value="1.0">자석 vs 철판 (x1)</option>
                <option value="2.0" selected>자석 vs 자석 (x2)</option>
                <option value="3.0">할바흐 배열 효과 (x3 가정)</option>
            </select>
        </div>
    </div>

    <div class="section-title">2. 지오메트리 (단위: mm)</div>
    <div class="input-grid">
        <div class="input-group">
            <label>가로 (Width, W)</label>
            <input type="number" id="width" value="20">
        </div>
        <div class="input-group">
            <label>세로 (Depth, D)</label>
            <input type="number" id="depth" value="20">
        </div>
        <div class="input-group">
            <label>두께 (Height, H)</label>
            <input type="number" id="thickness" value="10">
        </div>
        <div class="input-group">
            <label>공극 (Air Gap, z)</label>
            <input type="number" id="gap" value="9">
        </div>
    </div>

    <div class="section-title">3. 타겟 부하</div>
    <div class="input-grid">
        <div class="input-group">
            <label>헤드 무게 (Head Weight)</label>
            <input type="number" id="weight" value="1.5" step="0.1">
        </div>
    </div>

    <button onclick="calculate()">계산 및 검증 시작 (Calculate)</button>

    <div class="result-box" id="resultBox" style="display:none;">
        <div class="section-title" style="margin-bottom:20px;"> 계산 결과 (Summary)</div>
        
        <div class="result-row">
            <span class="result-label">1. 공극 자속 밀도 (Bz @ Gap)</span>
            <span class="result-value" id="resBz">- T</span>
        </div>
        <div class="result-row">
            <span class="result-label">2. 1쌍당 인력 (Force per Pair)</span>
            <span class="result-value" id="resForcePair">- N</span>
        </div>
        <div class="result-row" style="background: #eef7ff; border-radius: 8px; padding: 15px 10px;">
            <span class="result-label" style="color:#0071e3;">3. 총 인력 (Total Force)</span>
            <span class="result-value" id="resTotalForce" style="font-size: 1.4em;">- N</span>
        </div>
        <div class="result-row">
            <span class="result-label">안전율 (Safety Factor, 4.0 권장)</span>
            <span id="resSafetyBadge" class="badge safe">-</span>
        </div>
        <p id="resMessage" style="font-size: 14px; margin-top: 10px; color: #666;"></p>
    </div>

    <div class="verification-box" id="verBox" style="display:none;">
        <div class="ver-title"> 계산 검증 및 수식 상세 (Verification Log)</div>
        <div id="verContent"></div>
    </div>

</div>

<script>
    function calculate() {
        // --- 1. 변수 수집 ---
        const Br = parseFloat(document.getElementById('grade').value);
        const W_mm = parseFloat(document.getElementById('width').value);
        const D_mm = parseFloat(document.getElementById('depth').value);
        const H_mm = parseFloat(document.getElementById('thickness').value);
        const z_mm = parseFloat(document.getElementById('gap').value);
        
        const count = parseInt(document.getElementById('count').value);
        const couplingType = parseFloat(document.getElementById('coupling').value);
        const weight = parseFloat(document.getElementById('weight').value);

        // SI 단위 변환
        const W = W_mm / 1000;
        const D = D_mm / 1000;
        const H = H_mm / 1000;
        const z = z_mm / 1000;

        // --- 2. Bz 계산 (비오-사바르 기반 직육면체 중심축 공식) ---
        // 공식: Bz = (Br/pi) * [ atan(WD / 2z*sqrt(...)) - atan(WD / 2(z+H)*sqrt(...)) ]
        
        // Term A (가까운 면)
        const diag1 = Math.sqrt(4 * z * z + W * W + D * D);
        const arg1 = (W * D) / (2 * z * diag1);
        const term1 = Math.atan(arg1);

        // Term B (먼 면, 두께 H 포함)
        const z2 = z + H;
        const diag2 = Math.sqrt(4 * z2 * z2 + W * W + D * D);
        const arg2 = (W * D) / (2 * z2 * diag2);
        const term2 = Math.atan(arg2);

        const Bz = (Br / Math.PI) * (term1 - term2);

        // --- 3. Force 계산 (맥스웰 응력) ---
        // F = (B^2 * Area) / (2 * mu0)
        const mu0 = 4 * Math.PI * 1e-7; // 1.2566e-6
        const Area = W * D;
        
        // 기본 인력 (자석 -> 철판)
        const F_base = (Bz * Bz * Area) / (2 * mu0);
        
        // 결합 계수 적용
        const F_pair = F_base * couplingType;
        
        // 총 인력
        const F_total = F_pair * count;

        // --- 4. 결과 출력 (UI) ---
        document.getElementById('resultBox').style.display = 'block';
        document.getElementById('resBz').innerText = Bz.toFixed(4) + " Tesla";
        document.getElementById('resForcePair').innerText = F_pair.toFixed(2) + " N (" + (F_pair/9.8).toFixed(2) + "kgf)";
        document.getElementById('resTotalForce').innerText = F_total.toFixed(1) + " N (" + (F_total/9.8).toFixed(1) + "kgf)";

        // 안전율
        const gravity = weight * 9.8;
        const safetyFactor = F_total / gravity;
        const badge = document.getElementById('resSafetyBadge');
        
        badge.innerText = `x ${safetyFactor.toFixed(1)}`;
        badge.className = 'badge ' + (safetyFactor >= 4 ? 'safe' : (safetyFactor >= 2.5 ? 'warning' : 'danger'));

        const msgElem = document.getElementById('resMessage');
        if(safetyFactor >= 4) {
            msgElem.innerHTML = " <b>설계 적합:</b> 충격과 진동(4G)을 견딜 수 있는 충분한 자력입니다.";
            msgElem.style.color = "green";
        } else if (safetyFactor >= 2.5) {
            msgElem.innerHTML = " <b>설계 주의:</b> 평지 주행은 가능하나, 문턱 충격 시 머리가 이탈할 수 있습니다.";
            msgElem.style.color = "#d97706";
        } else {
            msgElem.innerHTML = " <b>설계 부적합:</b> 자력이 매우 부족합니다. 자석 두께나 개수를 늘리세요.";
            msgElem.style.color = "red";
        }

        // --- 5. 검증 로그 출력 (Verification Log) ---
        const verBox = document.getElementById('verBox');
        verBox.style.display = 'block';
        
        const content = document.getElementById('verContent');
        content.innerHTML = `
        <div style="margin-bottom:15px;">
            <span class="math-comment"># 1. 입력 변수 확인 (SI Unit)</span><br>
            Br (잔류자속) = <span class="math-num">${Br.toFixed(2)}</span> T<br>
            W (가로) = <span class="math-num">${W.toFixed(4)}</span> m, D (세로) = <span class="math-num">${D.toFixed(4)}</span> m<br>
            H (두께) = <span class="math-num">${H.toFixed(4)}</span> m<br>
            z (공극) = <span class="math-num">${z.toFixed(4)}</span> m
        </div>

        <div style="margin-bottom:15px;">
            <span class="math-comment"># 2. 자속 밀도(Bz) 계산 과정</span><br>
            <span class="math-comment">// 공식: Bz = (Br/π) * [atan(TermA) - atan(TermB)]</span><br>
            TermA (가까운 면) = atan(<span class="math-num">${arg1.toFixed(4)}</span>) = <span class="math-var">${term1.toFixed(4)}</span> rad<br>
            TermB (먼 면 보정) = atan(<span class="math-num">${arg2.toFixed(4)}</span>) = <span class="math-var">${term2.toFixed(4)}</span> rad<br>
            Bz = (<span class="math-num">${Br}</span> / π) * (<span class="math-var">${term1.toFixed(4)}</span> - <span class="math-var">${term2.toFixed(4)}</span>)<br>
            &nbsp;&nbsp;&nbsp;= <span class="math-res">${Bz.toFixed(5)} Tesla</span>
        </div>

        <div style="margin-bottom:15px;">
            <span class="math-comment"># 3. 인력(Force) 계산 과정</span><br>
            <span class="math-comment">// 공식: F = (Bz² * Area) / (2 * μ₀)</span><br>
            Area (단면적) = <span class="math-num">${Area.toFixed(6)}</span> m²<br>
            μ₀ (진공투자율) = 1.2566 × 10⁻⁶<br>
            F_base (기본) = (<span class="math-res">${Bz.toFixed(4)}</span>² * <span class="math-num">${Area.toFixed(6)}</span>) / (2 * μ₀)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="math-var">${F_base.toFixed(3)}</span> N
        </div>

        <div>
            <span class="math-comment"># 4. 최종 합산</span><br>
            Coupling Factor (결합계수 α) = <span class="math-num">${couplingType}</span><br>
            F_pair (1쌍 인력) = ${F_base.toFixed(3)} * ${couplingType} = <span class="math-res">${F_pair.toFixed(2)} N</span><br>
            F_total (총 ${count}개) = ${F_pair.toFixed(2)} * ${count} = <span class="math-res">${F_total.toFixed(2)} N</span><br>
            <br>
            <span class="math-comment">// 안전율 검증 (Target: 4.0G)</span><br>
            필요 하중(1G) = ${weight}kg * 9.8 = <span class="math-num">${gravity.toFixed(2)}</span> N<br>
            안전율 = ${F_total.toFixed(2)} / ${gravity.toFixed(2)} = <span class="math-res">x ${safetyFactor.toFixed(2)}</span>
        </div>
        `;
    }
</script>

</body>
</html>