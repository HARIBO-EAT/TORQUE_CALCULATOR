<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구형 로봇 상세 설계 계산기</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; line-height: 1.6; background-color: #f0f2f5; color: #333; }
        .container { max-width: 700px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 15px; margin-top: 0; text-align: center; }
        
        /* 입력 섹션 스타일 */
        .input-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        @media (max-width: 600px) { .input-section { grid-template-columns: 1fr; } }
        
        .input-group { position: relative; }
        label { display: block; font-weight: 600; margin-bottom: 5px; color: #34495e; font-size: 0.95em; }
        input { width: 100%; padding: 10px; border: 1px solid #ccd0d5; border-radius: 6px; box-sizing: border-box; font-size: 16px; transition: border 0.3s; background-color: #fcfcfc; }
        input:focus { border-color: #3498db; outline: none; background-color: #fff; }
        small { display: block; color: #7f8c8d; font-size: 0.8em; margin-top: 4px; }

        /* 결과 섹션 스타일 */
        .result-box { background: #e8f4fd; border-radius: 8px; border-left: 6px solid #3498db; padding: 20px; margin-bottom: 25px; }
        .result-item { display: flex; justify-content: space-between; align-items: center; margin: 8px 0; font-size: 1.1em; }
        .val { font-weight: bold; color: #e74c3c; font-size: 1.2em; }
        .unit { font-size: 0.9em; color: #555; width: 45px; text-align: right; }
        .total-row { margin-top: 15px; padding-top: 15px; border-top: 1px solid #bdc3c7; font-weight: bold; color: #2980b9; }

        /* 상세 수식 섹션 스타일 (신뢰성 확보 핵심) */
        .formula-log { background-color: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 8px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.9em; margin-top: 10px; }
        .log-title { color: #f1c40f; border-bottom: 1px solid #7f8c8d; padding-bottom: 5px; margin-bottom: 10px; font-weight: bold; }
        .log-line { margin-bottom: 8px; line-height: 1.4; word-break: break-all; }
        .var-hl { color: #4cd137; } /* 변수 하이라이트 */
    </style>
</head>
<body>
    <div class="container">
        <h2> 구형 로봇 상세 설계 계산기</h2>
        
        <div class="input-section">
            <div class="input-group">
                <label>로봇 질량 (m)</label>
                <input type="number" id="mass" value="10" step="0.1" oninput="calculate()">
                <small>단위: kg</small>
            </div>
            <div class="input-group">
                <label>로봇 반지름 (r)</label>
                <input type="number" id="radius" value="0.15" step="0.01" oninput="calculate()">
                <small>단위: m (예: 0.15)</small>
            </div>
            <div class="input-group">
                <label>경사각 (θ)</label>
                <input type="number" id="theta" value="15" step="1" oninput="calculate()">
                <small>단위: 도(°)</small>
            </div>
            <div class="input-group">
                <label>목표 가속도 (a)</label>
                <input type="number" id="accel" value="0.6" step="0.1" oninput="calculate()">
                <small>단위: m/s²</small>
            </div>
            <div class="input-group">
                <label>관성 모멘트 (I)</label>
                <input type="number" id="inertia" value="0.15" step="0.01" oninput="calculate()">
                <small>단위: kg·m²</small>
            </div>
            <div class="input-group">
                <label>장애물 높이 (h)</label>
                <input type="number" id="height" value="0.05" step="0.01" oninput="calculate()">
                <small>단위: m (예: 0.05)</small>
            </div>
        </div>

        <div class="result-box">
            <div class="result-item">
                <span> 등판 토크 (τ<sub>slope</sub>)</span>
                <span><span id="res-slope" class="val">0</span> <span class="unit">N·m</span></span>
            </div>
            <div class="result-item">
                <span> 가속 토크 (τ<sub>acc</sub>)</span>
                <span><span id="res-accel" class="val">0</span> <span class="unit">N·m</span></span>
            </div>
            <div class="result-item">
                <span> 장애물 토크 (τ<sub>step</sub>)</span>
                <span><span id="res-step" class="val">0</span> <span class="unit">N·m</span></span>
            </div>
            <div class="result-item total-row">
                <span> 전체 필요 토크 (τ<sub>total</sub>)</span>
                <span><span id="res-total" class="val">0</span> <span class="unit">N·m</span></span>
            </div>
        </div>

        <div class="formula-log">
            <div class="log-title"> 실시간 계산 과정 검증</div>
            <div id="log-content">
                </div>
        </div>
    </div>

    <script>
        function calculate() {
            // 입력값 가져오기
            const m = parseFloat(document.getElementById('mass').value) || 0;
            const r = parseFloat(document.getElementById('radius').value) || 0;
            const theta = parseFloat(document.getElementById('theta').value) || 0;
            const a = parseFloat(document.getElementById('accel').value) || 0;
            const I = parseFloat(document.getElementById('inertia').value) || 0;
            const h = parseFloat(document.getElementById('height').value) || 0;
            const g = 9.81;

            // 라디안 변환 및 사인값 미리 계산
            const thetaRad = theta * Math.PI / 180;
            const sinVal = Math.sin(thetaRad).toFixed(3);

            // 1. 등판 토크 계산
            const tSlope = m * g * Math.sin(thetaRad) * r;
            
            // 2. 가속 토크 계산
            let tAccel = 0;
            if (r > 0) tAccel = (I / r + m * r) * a;

            // 3. 전체 토크
            const tTotal = tSlope + tAccel;

            // 4. 장애물 토크 계산 및 검증 변수
            let tStep = 0;
            let stepLog = "";
            let armLength = 0; // 팔 길이 (모멘트 암)
            
            if (r > 0 && h < r) {
                // 피타고라스로 수평 거리(팔 길이) 계산
                // L = sqrt(r^2 - (r-h)^2)
                const term1 = Math.pow(r, 2);
                const term2 = Math.pow(r - h, 2);
                armLength = Math.sqrt(term1 - term2);
                tStep = m * g * armLength;
                
                stepLog = `τ<sub>step</sub> = ${m}<span class="var-hl">kg</span> × ${g} × √(${r}² - (${r}-${h})²) <br>
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= ${m} × ${g} × ${armLength.toFixed(3)}<span class="var-hl">m(팔길이)</span> = <strong>${tStep.toFixed(3)} N·m</strong>`;
            } else if (h >= r) {
                tStep = 9999;
                stepLog = `τ<sub>step</sub> = <span style="color:#e74c3c">불가능 (턱 높이 ${h}m가 반지름 ${r}m보다 큼)</span>`;
            } else {
                stepLog = `τ<sub>step</sub> = 계산 불가 (반지름 확인 필요)`;
            }

            // 결과 화면 업데이트
            document.getElementById('res-slope').innerText = tSlope.toFixed(3);
            document.getElementById('res-accel').innerText = tAccel.toFixed(3);
            document.getElementById('res-step').innerText = (tStep === 9999) ? "불가" : tStep.toFixed(3);
            document.getElementById('res-total').innerText = tTotal.toFixed(3);

            // 상세 계산 로그 업데이트 (HTML 생성)
            const logHTML = `
                <div class="log-line">
                    <strong>1. 등판 토크 (중력 극복)</strong><br>
                    τ<sub>slope</sub> = m · g · sin(θ) · r<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= ${m}<span class="var-hl">kg</span> × ${g} × sin(${theta}°) × ${r}<span class="var-hl">m</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= ${m} × ${g} × ${sinVal} × ${r} = <strong>${tSlope.toFixed(3)} N·m</strong>
                </div>
                <hr style="border-color:#555; opacity:0.3;">
                <div class="log-line">
                    <strong>2. 가속 토크 (관성 극복)</strong><br>
                    τ<sub>acc</sub> = (I/r + m·r) · a<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= (${I}/${r} + ${m}×${r}) × ${a}<span class="var-hl">m/s²</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= (${(I/r).toFixed(2)} + ${(m*r).toFixed(2)}) × ${a} = <strong>${tAccel.toFixed(3)} N·m</strong>
                </div>
                <hr style="border-color:#555; opacity:0.3;">
                <div class="log-line">
                    <strong>3. 장애물 극복 (정적 평형 기준)</strong><br>
                    ${stepLog}
                </div>
            `;
            document.getElementById('log-content').innerHTML = logHTML;
        }

        window.onload = calculate;
    </script>
</body>
</html>