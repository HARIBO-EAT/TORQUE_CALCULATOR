<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구형 로봇 모터 선정 계산기</title>
    <style>
        body { font-family: 'Segoe UI', 'Apple SD Gothic Neo', sans-serif; padding: 20px; line-height: 1.6; background-color: #f0f2f5; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h2 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 15px; text-align: center; }
        
        /* 입력 섹션 */
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .input-group { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef; }
        .input-group label { display: block; font-weight: 700; margin-bottom: 5px; color: #495057; font-size: 0.95em; }
        .input-group input { width: 90%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 16px; }
        .input-group small { display: block; color: #868e96; font-size: 0.8em; margin-top: 4px; }
        
        /* 결과 비교 박스 */
        .compare-box { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        @media (max-width: 600px) { .compare-box { grid-template-columns: 1fr; } }
        
        .scenario-card { padding: 20px; border-radius: 10px; border: 2px solid transparent; }
        .scenario-a { background-color: #e3f2fd; border-color: #90caf9; } /* 파란색: 경사 */
        .scenario-b { background-color: #ffebee; border-color: #ef9a9a; } /* 빨간색: 장애물 */
        
        .card-title { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; display: block; text-align: center; }
        .card-val { font-size: 1.4em; font-weight: 800; display: block; text-align: center; margin: 10px 0; }
        .card-detail { font-size: 0.9em; color: #555; text-align: center; }

        /* 최종 결과 */
        .final-box { background: #263238; color: white; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .final-val { font-size: 1.8em; font-weight: bold; color: #ffeb3b; }

        /* 로그 박스 */
        .log-box { background: #37474f; color: #eceff1; padding: 20px; border-radius: 8px; font-family: 'Consolas', monospace; font-size: 0.9em; overflow-x: auto; }
        .log-header { color: #81d4fa; font-weight: bold; border-bottom: 1px solid #546e7a; padding-bottom: 8px; margin-bottom: 10px; }
        .formula { color: #ffcc80; margin-bottom: 3px; } /* 수식 색상 */
        .calc-line { margin-bottom: 15px; padding-left: 10px; border-left: 2px solid #546e7a; }
        .var-hl { color: #69f0ae; }
    </style>
</head>
<body>
    <div class="container">
        <h2>구형 로봇 모터 선정 계산기</h2>
        
        <div class="input-grid">
            <div class="input-group">
                <label>① 로봇 질량 (m)</label>
                <input type="number" id="mass" value="10" step="0.1" oninput="calculate()">
                <small>단위: kg (전체 무게)</small>
            </div>
            <div class="input-group">
                <label>② 반지름 (r)</label>
                <input type="number" id="radius" value="0.15" step="0.01" oninput="calculate()">
                <small>단위: m (지름의 절반)</small>
            </div>
            <div class="input-group">
                <label>③ 최대 경사각 (θ)</label>
                <input type="number" id="theta" value="15" step="1" oninput="calculate()">
                <small>단위: 도(°)</small>
            </div>
            <div class="input-group">
                <label>④ 목표 가속도 (a)</label>
                <input type="number" id="accel" value="0.6" step="0.1" oninput="calculate()">
                <small>단위: m/s²</small>
            </div>
            <div class="input-group">
                <label>⑤ 장애물 높이 (h)</label>
                <input type="number" id="height" value="0.05" step="0.01" oninput="calculate()">
                <small>단위: m (턱 높이)</small>
            </div>
            <div class="input-group" style="border-color: #ffb74d;">
                <label>⑥ 안전 계수 (Sf)</label>
                <input type="number" id="safety" value="1.5" step="0.1" oninput="calculate()">
                <small>2.0배 이상</small>
            </div>
        </div>

        <div class="compare-box">
            <div class="scenario-card scenario-a">
                <span class="card-title"> Case 1: 경사로</span>
                <span class="card-val"><span id="total-slope">0</span> N·m</span>
                <div class="card-detail">
                    등판(τ<sub>slope</sub>) + 가속(τ<sub>acc</sub>)<br>
                    <span id="detail-slope" style="font-size:0.8em; opacity:0.8;">0 + 0</span>
                </div>
            </div>
            
            <div class="scenario-card scenario-b">
                <span class="card-title"> Case 2: 장애물</span>
                <span class="card-val"><span id="total-step">0</span> N·m</span>
                <div class="card-detail">
                    장애물(τ<sub>step</sub>) + 가속(τ<sub>acc</sub>)<br>
                    <span id="detail-step" style="font-size:0.8em; opacity:0.8;">0 + 0</span>
                </div>
            </div>
        </div>

        <div class="final-box">
            <div style="margin-bottom: 5px; font-size: 1.1em;"> 최종 권장 모터 스펙 (안전계수 <span id="safety-disp">1.5</span>배 적용)</div>
            <div class="final-val"><span id="final-result">0</span> N·m 이상</div>
            <div style="font-size: 0.8em; opacity: 0.7;">* 두 시나리오 중 더 큰 부하(Worst Case)를 기준으로 산정함</div>
        </div>

        <div class="log-box">
            <div class="log-header"> 실시간 공식 대입 & 검증 로그</div>
            <div id="log-content"></div>
        </div>
    </div>

    <script>
        function calculate() {
            // 입력값
            const m = parseFloat(document.getElementById('mass').value) || 0;
            const r = parseFloat(document.getElementById('radius').value) || 0;
            const theta = parseFloat(document.getElementById('theta').value) || 0;
            const a = parseFloat(document.getElementById('accel').value) || 0;
            const h = parseFloat(document.getElementById('height').value) || 0;
            const safety = parseFloat(document.getElementById('safety').value) || 1.5;
            
            // 물리 상수
            const g = 9.81;
            const I = (r > 0) ? (2/3) * m * r * r : 0; // 구형 쉘 관성모멘트
            const thetaRad = theta * Math.PI / 180;

            // --- 1. 가속 토크 (공통) ---
            // 공식: τ_acc = (I/r + mr) * a
            const tAccel = (r > 0) ? (I / r + m * r) * a : 0;

            // --- 2. 등판 토크 (시나리오 A) ---
            // 공식: τ_slope = mg * sin(θ) * r
            const tSlope = m * g * Math.sin(thetaRad) * r;
            const totalA = tSlope + tAccel;

            // --- 3. 장애물 토크 (시나리오 B) ---
            // 공식: τ_step = mg * sqrt(r² - (r-h)²)
            let tStep = 0;
            let armLength = 0;
            let stepValid = true;

            if (r > 0 && h < r) {
                armLength = Math.sqrt(Math.pow(r, 2) - Math.pow(r - h, 2));
                tStep = m * g * armLength;
            } else if (h >= r) {
                stepValid = false;
            }
            // 장애물 넘을 때도 가속도(관성)를 고려하여 더함 (최악조건)
            const totalB = (stepValid) ? (tStep + tAccel) : 9999; 

            // --- 4. 최종 결과 산출 ---
            // 둘 중 큰 값 선택 (Max Load)
            const maxLoad = (stepValid && totalB > totalA) ? totalB : totalA;
            const finalSafe = maxLoad * safety;

            // 화면 업데이트
            document.getElementById('safety-disp').innerText = safety;
            
            // 시나리오 A 표시
            document.getElementById('total-slope').innerText = totalA.toFixed(2);
            document.getElementById('detail-slope').innerText = `등판 ${tSlope.toFixed(2)} + 가속 ${tAccel.toFixed(2)}`;

            // 시나리오 B 표시
            if (stepValid) {
                document.getElementById('total-step').innerText = totalB.toFixed(2);
                document.getElementById('detail-step').innerText = `장애물 ${tStep.toFixed(2)} + 가속 ${tAccel.toFixed(2)}`;
            } else {
                document.getElementById('total-step').innerText = "불가";
                document.getElementById('detail-step').innerText = "높이 ≥ 반지름";
            }

            // 최종 결과 표시
            if (stepValid) {
                document.getElementById('final-result').innerText = finalSafe.toFixed(2);
            } else {
                document.getElementById('final-result').innerText = "설계 수정 필요";
            }

            // --- 5. 상세 로그 생성 (HTML) ---
            let logHTML = "";

            // [로그] 가속 토크
            logHTML += `<div class="formula"> 가속 토크 공식: τ<sub>acc</sub> = (I/r + m·r) × a</div>`;
            logHTML += `<div class="calc-line">`;
            logHTML += `&nbsp;= (${(I/r).toFixed(3)} + ${(m*r).toFixed(3)}) × ${a}<br>`;
            logHTML += `&nbsp;= <span class="var-hl">${tAccel.toFixed(3)} N·m</span>`;
            logHTML += `</div>`;

            // [로그] 등판 토크
            logHTML += `<div class="formula"> 등판 토크 공식: τ<sub>slope</sub> = m · g · sin(θ) · r</div>`;
            logHTML += `<div class="calc-line">`;
            logHTML += `&nbsp;= ${m} × ${g} × sin(${theta}°) × ${r}<br>`;
            logHTML += `&nbsp;= <span class="var-hl">${tSlope.toFixed(3)} N·m</span>`;
            logHTML += `</div>`;

            // [로그] 장애물 토크
            logHTML += `<div class="formula"> 장애물 토크 공식: τ<sub>step</sub> = m · g · √(r² - (r-h)²)</div>`;
            logHTML += `<div class="calc-line">`;
            if (stepValid) {
                logHTML += `&nbsp;= ${m} × ${g} × ${armLength.toFixed(3)} (팔길이)<br>`;
                logHTML += `&nbsp;= <span class="var-hl">${tStep.toFixed(3)} N·m</span>`;
            } else {
                logHTML += `&nbsp;<span style="color:#ff5252">계산 불가 (턱 높이 ${h}m가 반지름 ${r}m보다 큼)</span>`;
            }
            logHTML += `</div>`;

            // [로그] 최종 판단
            logHTML += `<div class="formula"> 최종 선정 논리: Max(시나리오 A, B) × 안전계수</div>`;
            logHTML += `<div class="calc-line" style="border-left-color: #ffeb3b;">`;
            if (stepValid) {
                const winner = (totalB > totalA) ? "시나리오 B(장애물)" : "시나리오 A(경사로)";
                logHTML += `&nbsp;더 힘든 조건인 <strong>[${winner}]</strong> 채택<br>`;
                logHTML += `&nbsp;= ${maxLoad.toFixed(2)} × ${safety} (안전계수)<br>`;
                logHTML += `&nbsp;= <strong style="color:#ffeb3b; font-size:1.2em;">${finalSafe.toFixed(2)} N·m</strong>`;
            } else {
                logHTML += `&nbsp;장애물 극복 불가능으로 계산 중단`;
            }
            logHTML += `</div>`;

            document.getElementById('log-content').innerHTML = logHTML;
        }

        window.onload = calculate;
    </script>
</body>
</html>